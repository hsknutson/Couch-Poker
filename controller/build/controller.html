<!DOCTYPE html>
<html>
<head>
	<style type="text/css">
		body {
	margin: 0;
}

.view {
	height: 100vh;
	width: 100vw;
}

#start-view {
	display: grid;
	grid-template-areas: "."
											 "form"
											 "."
											 "submit";
	place-items: center;
}

#enter-username-div {
	grid-area: form;
}

#submit-username-div {
	grid-area: submit;
}
	</style>
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body onload="init()">
	<div id="no-game-view" class="view default-view">

	</div>

	<div id="start-view" class="view">
		<div id="enter-username-div">
			<input id="input-username" type="text" name="username" placeholder="Enter Username">
		</div>
		<div id="submit-username-div">
			<button id="submit-username">Submit</button>
		</div>
	</div>

	<div id="wait-view" class="view">
		<h1>Waiting view</h1>
	</div>

	<div id="action-view" class="view">
		<h1>Action View</h1>
	</div>

	<div id="analytics-view" class="view">
		<h1>Analytics View</h1>
	</div>

	<script type="text/javascript" src="https://www.airconsole.com/api/airconsole-1.7.0.js"></script>
	<script type="text/javascript">
		var airconsole = null;
var vm = null;

function init() {
	airconsole = new AirConsole({"orientation": "portrait"});

	airconsole.onReady = function() {
    // Init the ViewManager
    vm = new AirConsoleViewManager(airconsole);
  };

  /*
   * Checks if this device is part of the active game.
   */
  airconsole.onActivePlayersChange = function(player) {
  var div = document.getElementById("player_id");
    if (player !== undefined) {
      vm.show('no-game-view');
    } else {
      vm.show('start-view');
    }
  };


  document.getElementById('submit-username')
  	.addEventListener("click", submitUsername);
 	
}

function submitUsername() {
	username = document.getElementById('input-username').value;
	if (username == "") {
		alert("Please enter a username.");
	}

	var message = {
		'action': 'TAKE_SEAT',
		'username': username
	};

	airconsole.message(airconsole.SCREEN, message);
}
	</script>
	<script type="text/javascript">
		/**
 * A view manager for both screen and controller
 * @params {AirConsole} airconsole - The airconsole instance
 * @constructor
 */
var AirConsoleViewManager = function(airconsole) {
  this.airconsole = airconsole;
  this.views = {};
  this.current_view = {
    self: null,
    ctrl: null,
    screen: null
  };
  this.class_start = 'default-view';
  this.is_screen = airconsole.device_id === AirConsole.SCREEN;
  this.setupViews_();
};

AirConsoleViewManager.prototype = {

  /**
   * Called to setup the <div class="view"></div>
   * @private
   */
  setupViews_: function() {
    var start_view_id = null;
    var views = document.querySelectorAll('.view');
    for (var i = 0; i < views.length; i++) {
      var view = views[i];
      var id = view.id;
      this.views[id] = view;
      var is_start = view.className.indexOf(this.class_start) > -1;
      if (is_start) {
        start_view_id = id;
      }
    }
    this.hideAll();
    if (start_view_id) {
      this.show(start_view_id);
    }
  },

  /**
   * Called onDeviceStateChange
   * @param {Object} custom_data - The device user data
   * @param {Function} cb - A callback function. Gets called when view was changed
   */
  onViewChange: function(custom_data, cb) {
    if (!custom_data) return;
    var screen_view = custom_data.screen_view;
    var ctrl_view = custom_data.ctrl_view;
    var view_id = this.is_screen ? screen_view : ctrl_view;
    if (view_id) {
      if (this.show(view_id) && typeof cb === 'function') {
        cb(view_id);
      }
    }
  },

  /**
   * Sets the device custom state
   * @param {String} key
   * @param {Mixed} value
   */
  setState: function(key, value) {
    this.airconsole.setCustomDeviceStateProperty(key, value);
  },

  /**
   * Triggers a view change on all controllers
   * @param {String} view - The view id
   * @param {Boolean} except_me - This controller will not change the view
   */
  controllersShow: function(view, except_me) {
    if (!view) return;
    this.setState('ctrl_view', view);
    if (!this.is_screen && !except_me) {
      this.show(view);
    }
  },

  /**
   * Triggers a view change on the screen
   * @param {String} view - The view id
   */
  screenShow: function(view) {
    if (!view) return;
    this.setState('screen_view', view);
    if (this.is_screen) {
      this.show(view);
    }
  },

  /**
   * Triggers a view change on both the screen and controllers
   * @param {String} view - The view id
   */
  allShow: function(view) {
    this.screenShow(view);
    this.controllersShow(view);
  },

  /**
   * Shows a view and hides all others
   * @param {String} view - The view id
   */
  show: function(id) {
    var state = false;
    if (this.current_view.self !== id) {
      var view = this.views[id];
      if (view) {
        this.current_view.self = id;
        this.hideAll();
        view.style.display = "block";
        state = true;
      } else {
        console.warn("Could not find view with ID:", id);
      }
    }
    return state;
  },

  /**
   * Hides all views
   */
  hideAll: function() {
    for (var key in this.views) {
      this.views[key].style.display = "none";
    }
  }

};

	</script>
</body>
</html>
